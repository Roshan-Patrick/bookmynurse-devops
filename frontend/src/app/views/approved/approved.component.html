<c-row>
  <c-col xs>
    <c-card style="padding: 0 !important;" class="mb-4 nurse-card">
      <c-card-header class="table-header">Approved Nurses</c-card-header>
      <c-card-body style="padding: 0 !important;">
        <table [hover]="true" [responsive]="true" [striped]="true" cTable class="mb-4 border table-styled">
          <thead cTableColor="light">
            <tr>
              <th class="text-center"><svg cIcon name="cilPeople"></svg></th>
              <th class="text-center">Name</th>
              <th class="text-center">Mobile</th>
              <th class="text-center">Email</th>
              <th class="text-center">Action</th>
              <th class="text-center">Availability</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users; index as i">

              <!-- ✅ Photo Avatar -->
              <td class="text-center">
                <c-avatar size="xl" [src]="user.photoUrl"></c-avatar>
              </td>

              <!-- Name -->
              <td class="text-center">
                <div>{{ user.name }}</div>
              </td>

              <!-- Mobile -->
              <td class="text-center">
                <div>{{ user.mobile }}</div>
              </td>

              <!-- Email -->
              <td class="text-center">
                <div>{{ user.email }}</div>
              </td>

              <!-- ✅ Action: View Details → Edit → Delete -->
              <td class="text-center">
                <div class="button-container">

                  <!-- View Details -->
                  <button (click)="openModal(user)" cButton style="background-color: #007bff; color: white;"
                    class="me-2">
                    <svg cIcon class="me-2" name="cil-magnifying-glass"></svg>
                    View Details
                  </button>

                  <!-- Edit -->
                  <button (click)="onEdit(user)" [cModalToggle]="'fullScreenSm'" cButton
                    style="background-color: #17a2b8; color: white;" class="me-2">
                    <svg cIcon class="me-2" name="cil-pencil"></svg>
                    Edit
                  </button>

                  <!-- Delete -->
                  <button (click)="onDelete(user.id)" cButton style="background-color: #dc3545; color: white;">
                    <svg cIcon class="me-2" name="cil-trash"></svg>
                    Delete
                  </button>
                  <!-- Inside Action column -->
                  <button (click)="openSetChargesModal(user)" cButton style="background-color: #6f42c1; color: white;">
                    <svg cIcon class="me-2" name="cilEnvelopeOpen"></svg> Set Charges
                  </button>

                  <!-- <button class="btn btn-sm btn-success" (click)="openChargesTypeModal(user)">
                    Set Charges Type
                  </button>      -->

                </div>
              </td>

              <!-- ✅ Availability: Available → Busy → Pending -->
              <td class="text-center"
                [ngClass]="{'available-bg': user.availability === 'Available', 'busy-bg': user.availability === 'Unavailable', 'pending-bg': user.availability === 'Pending'}">
                <div *ngIf="user.availability === 'Available'">
                  <div class="button-container">
                    <button (click)="isAvailable(user)" [cModalToggle]="'fullScreenSmdelete'" cButton
                      style="background-color: #28a745; color: white;">
                      <svg cIcon class="me-2" name="cil-check"></svg>
                      Available
                    </button>
                  </div>
                </div>
                <div *ngIf="user.availability === 'Unavailable'">
                  <div class="button-container">
                    <button (click)="isAvailable(user)" [cModalToggle]="'fullScreenSmdelete'" cButton
                      style="background-color: #e63946; color: white;">
                      <svg cIcon class="me-2" name="cil-Loop"></svg>
                      Unavailable
                    </button>
                  </div>
                </div>
                <div *ngIf="user.availability === 'Pending'">
                  <div class="button-container">
                    <button (click)="isAvailable(user)" [cModalToggle]="'fullScreenSmdelete'" cButton
                      style="background-color: #ffc107; color: black;">
                      <svg cIcon class="me-2" name="cil-AvTimer"></svg>
                      Pending
                    </button>
                  </div>
                </div>
              </td>

            </tr>
          </tbody>
        </table>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>


<div *ngIf="isSetChargesModalOpen" class="custom-modal-overlay-1">
  <div class="custom-modal-1">
    <div class="modal-header-1">
      <h5>Set Charges for {{ selectedUser?.name }}</h5>
      <button class="close-btn-1" (click)="closeSetChargesModal()">×</button>
    </div>

    <div class="modal-body">
      <label>Enter Charges <span class="text-muted">(₹)</span></label>
      <input type="text"
             [(ngModel)]="chargesInput"
             class="form-control"
             inputmode="decimal"
             pattern="^\d+(\.\d{1,2})?$"
             maxlength="10"
             (keypress)="validateDecimalInput($event)"
             placeholder="Enter amount (e.g., 1200.00)" />

      <label class="mt-3">Charges Type</label>
      <select class="form-control" [(ngModel)]="charges_type ">
        <option value="per_day">Per Day</option>
        <option value="per_week">Per Week</option>
        <option value="per_month">Per Month</option>
      </select>

      <button class="btn btn-success mt-3 w-100" (click)="saveCharges()">Save Charges</button>
    </div>
  </div>
</div>



<!-- <c-modal size="lg" [visible]="showChargesTypeModal">
  <c-modal-header>
    <h5 cModalTitle>Set Charges Type</h5>
    <button type="button" cButtonClose (click)="showChargesTypeModal = false"></button>
  </c-modal-header>

  <c-modal-body>
    <div class="mb-3">
      <label for="chargesTypeInput" class="form-label">Enter Charges Type</label>
      <input
        type="text"
        id="chargesTypeInput"
        class="form-control"
        [(ngModel)]="selectedChargesType"
        placeholder="e.g., per day, per week, per month"
      />
    </div>
  </c-modal-body>

  <c-modal-footer>
    <button type="button" cButton color="secondary" (click)="showChargesTypeModal = false">Cancel</button>
    <button type="button" cButton color="primary" (click)="saveChargesType()">Save</button>
  </c-modal-footer>
</c-modal> -->


<c-modal #fullScreenSm fullscreen="sm" id="fullScreenSm">
  <c-modal-header>
    <h5 cModalTitle>Edit Details</h5>
    <button [cModalToggle]="'fullScreenSm'" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <!-- Modal form -->
    <form (ngSubmit)="updateUser()">
      <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" id="name" class="form-control" [(ngModel)]="selectedUser.name" name="name" />
      </div>
      <!-- <div class="mb-3">
        <label for="mobile" class="form-label">Aadhaar</label>
        <input type="text" id="mobile" class="form-control" [(ngModel)]="selectedUser.aadhaar" name="mobile" />
      </div> -->
      <div class="mb-3">
        <label for="gender" class="form-label">Mobile</label>
        <input type="text" id="gender" class="form-control" [(ngModel)]="selectedUser.mobile" name="gender" />
      </div>
      <div class="mb-3">
        <label for="location" class="form-label">Email</label>
        <input type="text" id="location" class="form-control" [(ngModel)]="selectedUser.email" name="location" />
      </div>
      <div class="mb-3">
        <label for="services" class="form-label">Gender</label>
        <input type="text" id="gender" class="form-control" [(ngModel)]="selectedUser.gender" name="services" />
      </div>
      <div class="mb-3">
        <label for="dob" class="form-label">DOB</label>
        <input type="date" id="dob" class="form-control" [(ngModel)]="selectedUser.dob" name="dob" />
      </div>
      <div class="mb-3">
        <label for="education" class="form-label">Education</label>
        <input type="text" id="education" class="form-control" [(ngModel)]="selectedUser.education" name="education" />
      </div>
      <div class="mb-3">
        <label for="experience" class="form-label">Experience</label>
        <input type="text" id="experience" class="form-control" [(ngModel)]="selectedUser.experience"
          name="experience" />
      </div>
      <div class="mb-3 position-relative">
        <label for="languages" class="form-label">Languages</label>

        <div #dropdownContainer class="dropdown-wrapper">


          <!-- Input Field (readonly, shows selected values) -->
          <input type="text" class="form-control custom-input" [value]="selectedUser.languages.join(', ')" readonly
            (click)="toggleDropdown()" placeholder="Select Languages" />

          <!-- Dropdown Menu -->
          <div class="dropdown-menu show custom-dropdown" *ngIf="dropdownOpen">
            <c-form-check *ngFor="let language of languageOptions">
              <input type="checkbox" id="languages" cFormCheckInput [id]="language.value" [value]="language.value"
                [checked]="selectedUser.languages.includes(language.value)"
                (change)="toggleSelection(language.value, $event)" />
              <label cFormCheckLabel [for]="language.value">
                {{ language.name }}
              </label>
            </c-form-check>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="specialization" class="form-label">Specialization</label>
        <input type="text" id="specialization" class="form-control" [(ngModel)]="selectedUser.specialization"
          name="specialization" />
      </div>
      <div class="mb-3">
        <label for="serviceopt" class="form-label">Service Options</label>
        <input type="text" id="serviceopt" class="form-control" [(ngModel)]="selectedUser.serviceopt"
          name="serviceopt" />
      </div>
      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input type="text" id="address" class="form-control" [(ngModel)]="selectedUser.address" name="address" />
      </div>
      <div class="mb-3">
        <label for="base_location" class="form-label">Base Location</label>
        <input type="text" id="base_location" class="form-control" [(ngModel)]="selectedUser.base_location"
          name="base_location" />
      </div>
      <button type="submit" cButton color="primary" [cModalToggle]="'fullScreenSm'"
        (click)="updateUser()">Submit</button>
    </form>
  </c-modal-body>
</c-modal>

<c-modal #fullScreenSmdelete fullscreen="sm" id="fullScreenSmdelete">
  <c-modal-header>
    <h5 cModalTitle>Nurse Availability</h5>
    <!-- <button [cModalToggle]="'fullScreenSmdelete'" cButtonClose></button> -->
  </c-modal-header>
  <c-modal-body>
    <div style="margin-bottom: 8px;">
      Ensure the Availability of the Nurse
    </div>
    <c-form-check inline>
      <input [(ngModel)]="selectedUser.availability" cFormCheckInput checked id="radioinline1" name="radioinline"
        type="radio" value="Available" />
      <label cFormCheckLabel for="radioinline1">Available</label>
    </c-form-check>
    <c-form-check inline>
      <input [(ngModel)]="selectedUser.availability" cFormCheckInput id="radioinline2" name="radioinline" type="radio"
        value="Unavailable" />
      <label cFormCheckLabel for="radioinline2">Unavailable</label>
    </c-form-check>
  </c-modal-body>
  <c-modal-footer>
    <button [cModalToggle]="'fullScreenSmdelete'" cButton color="secondary">
      Close
    </button>
    <button (click)="onApproveBooking()" [cModalToggle]="'fullScreenSmdelete'" cButton color="danger">Submit</button>
  </c-modal-footer>
</c-modal>


<!-- Modal Popup with Conditional Rendering -->
<c-modal [(visible)]="isModalVisible" size="lg" [backdrop]="true" class="custom-modal">
  <c-modal-header class="modal-header-styled">
    <h5 class="modal-title">User Details</h5>
    <button type="button" class="close" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </c-modal-header>

  <c-modal-body>
    <div *ngIf="selectedUser" class="modal-content-styled">
      <div class="row">
        <div class="col-md-6">
          <p *ngIf="selectedUser.aadhaar"><strong>Aadhaar:</strong> {{ selectedUser.aadhaar }}</p>
          <p *ngIf="selectedUser.gender"><strong>Gender:</strong> {{ selectedUser.gender }}</p>
          <p *ngIf="selectedUser.dob"><strong>DOB:</strong> {{ selectedUser.dob | date: 'dd-MM-yyyy' }}</p>
          <p *ngIf="selectedUser.education"><strong>Qualification:</strong> {{ selectedUser.education }}</p>
          <p *ngIf="selectedUser.experience"><strong>Experience:</strong> {{ selectedUser.experience }} years</p>
        </div>
        <div class="col-md-6">
          <p *ngIf="selectedUser.languages"><strong>Languages:</strong> {{ selectedUser.languages }}</p>
          <p *ngIf="selectedUser.specialization"><strong>Specialization:</strong> {{ selectedUser.specialization }}</p>
          <p *ngIf="selectedUser.address"><strong>Address:</strong> {{ selectedUser.address }}</p>
          <p *ngIf="selectedUser.serviceopt"><strong>Service Options:</strong> {{ selectedUser.serviceopt }}</p>
          <p *ngIf="selectedUser.base_location"><strong>Base Location:</strong> {{ selectedUser.base_location }}</p>
          <p><strong>Charges:</strong> {{ selectedUser.charges }}</p>
        </div>
      </div>
    </div>
  </c-modal-body>

  <c-modal-footer>
    <button (click)="closeModal()" cButton color="secondary">Close</button>
  </c-modal-footer>
</c-modal>